---
title: "Classificação de sinais de EEG com modelos de regressão funcional"
author: |
  | Rodrigo Marcel Araujo Oliveira Araujo\thanks{Número USP: 9299208}
date: "`r stringr::str_to_sentence(format(Sys.time(), '%B de %Y'))`"
lang: pt-BR
header-includes:
  # - \usepackage[brazilian]{babel}
  - \usepackage{float}
  - \usepackage{amsmath}
  - \usepackage{amsthm}
  - \floatplacement{figure}{H}
  - \usepackage{indentfirst}
  - \setlength{\parindent}{4em}
  - \setlength{\parskip}{1em}
  - \usepackage{booktabs}
  - \usepackage{dcolumn}
  - \usepackage{bm}
  - \usepackage{titling}
  - \thanksmarkseries{arabic} % \thanks footnotes com numeros
  - \usepackage[bottom]{footmisc} % corrige posição footnotes
  - \usepackage{pdfpages}
  - \usepackage{tocloft}
  - \renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
  - \usepackage{amssymb}
  - \renewcommand\qedsymbol{$\blacksquare$}
  - \usepackage{cleveref}
output: 
  pdf_document: 
    fig_caption: yes
    # number_sections: yes
    toc: true
    toc_depth: 2
#keep_tex: true
editor_options: 
  chunk_output_type: console
# bibliography: ref.bib
---
  
\pagebreak

\newcommand\invisiblesection[1]{%
  \refstepcounter{section}%
  \addcontentsline{toc}{section}{#1}%
  \sectionmark{#1}}
  
<!-- \newcommand\invisiblesection[1]{% -->
<!--   \refstepcounter{section}% -->
<!--   \addcontentsline{toc}{section}{\protect\numberline{\thesection}#1}% -->
<!--   \sectionmark{#1}} -->

<!-- \newcommand\invisiblessection[1]{% -->
<!--   \refstepcounter{subsection}% -->
<!--   \addcontentsline{toc}{subsection}{\protect\numberline{\thesection}#1}% -->
<!--   \sectionmark{#1}} -->


```{r setup, include=FALSE}
# options(tinytex.verbose = TRUE)

# template com paramentros padrao para as figuras
knitr::opts_template$set(figuras = list(echo = FALSE, 
                                        results='hide', 
                                        fig.show = "hold",
                                        fig.align = 'center',
                                        fig.ncol = 1,
                                        # fig.width = 4,
                                        # fig.height = 4,
                                        out.width = "\\textwidth",
                                        out.height = "0.9\\textheight"
))
knitr::opts_template$set(figuras2 = list(echo = FALSE, 
                                         results='hide', 
                                         fig.show = "hold",
                                         fig.align = 'center',
                                         fig.ncol = 2,
                                         fig.width = 4,
                                         out.width = "0.48\\textwidth", 
                                         out.height = "0.30\\textheight"))

knitr::opts_template$set(
  series = list(echo = FALSE, 
                results='hide', 
                fig.show = "hold",
                warning=FALSE,
                fig.align = 'center',
                fig.ncol = 1,
                fig.heigth=3, 
                fig.width=16
                # out.width = "\\textheight"
                ))

# uso: <<r, opts.label='figuras'>>=
# uso: ```{r, opts.label='figuras'}


```


```{r func_aux, include=FALSE}

kable <- function(...) {
  args <- list(
    ...,
    {if(!interactive() & knitr::is_latex_output()) format = 'latex'},
    digits = 2,
    booktabs = TRUE,
    format.args = list(
      # scientific=T,
      # nsmall = 2,
      decimal.mark = ",", 
      big.mark = "."
      )
    )
  
  args <- args[!duplicated(names(args))]
  
  do.call(knitr::kable, args) %>% kable_styling(latex_options = "HOLD_position")
}



```

```{r libs, include=FALSE}

knitr::opts_chunk$set(
  
  echo = TRUE, 
  message = FALSE, 
  warning = FALSE
)

```


```{r, include=FALSE}
library(tidyverse)
library(knitr)
library(stargazer)
library(tidyverse)
library(kableExtra)
library(ggplot2)
library(readxl)
library(MASS)
library(psych)
library(Hmisc)
library(GPArotation)

library(readr)
library(dplyr)
library(visdat)
library(VIM)


library(caret)
library(FDboost)
library("gamboostLSS")
library(dplyr)
```


# Leitura dos dados de treino

```{r}
alcoholism_train = read.csv("C:\\Users\\Rodrigo Araujo\\Documents\\IME-USP\\IC - EEG\\Alcoholism\\Data_clear\\Alcoholism_train.csv", sep = ',')

s2_match_train <- alcoholism_train %>% filter(matching.condition=="S2 match") %>% dplyr::select(subject.identifier, time, sensor.value, channel)


head(s2_match_train) %>% kable(caption="Dados Treino")
```


# Leitura dos dados de teste

```{r}
alcoholism_test = read.csv("C:\\Users\\Rodrigo Araujo\\Documents\\IME-USP\\IC - EEG\\Alcoholism\\Data_clear\\Alcoholism_test.csv", sep = ',')

s2_match_test <- alcoholism_test %>% filter(matching.condition=="S2 match") %>% dplyr::select(subject.identifier, time, sensor.value, channel)

head(s2_match_test) %>% kable(caption="Dados Teste")

```

# Tratamento dos dados

```{r}
s2_match_train$subject.identifier <-ifelse(s2_match_train$subject.identifier=="a",1,0)
s2_match_test$subject.identifier <-ifelse(s2_match_test$subject.identifier=="a",1,0)

s2_match_train$subject.identifier <- as.factor(s2_match_train$subject.identifier)
s2_match_train$time <- as.numeric(s2_match_train$time)
s2_match_train$sensor.value <- as.numeric(s2_match_train$sensor.value)
s2_match_train$channel <- as.factor(s2_match_train$channel)


s2_match_test$subject.identifier <- as.factor(s2_match_test$subject.identifier)
s2_match_test$time <- as.numeric(s2_match_test$time)
s2_match_test$sensor.value <- as.numeric(s2_match_test$sensor.value)
s2_match_test$channel <- as.factor(s2_match_test$channel)

```

# FDboost

```{r}
sof_binary <- FDboost(
  subject.identifier ~ 1 +
  sensor.value + 
  channel +
  time,
  data = s2_match_train,
  family = Binomial(),
  control = boost_control(mstop = 100),
  timeformula = NULL)

predictions <- predict(sof_binary, type = "response")
round_preds <- round(predictions)
t_train <- table(round_preds, s2_match_train$subject.identifier)
t_train
# acc
t_train %>% diag() %>% sum () / t_train %>% sum()

```


## Predict test
```{r}
predict_model <- predict(sof_binary, newdata = s2_match_test, type = "response")
round_preds_test <- round(predict_model)
table(round_preds_test, s2_match_test$subject.identifier)
```
